% Template for ICIP-2018 paper; to be used with:
%          spconf.sty  - ICASSP/ICIP LaTeX style file, and
%          IEEEbib.bst - IEEE bibliography style file.
% --------------------------------------------------------------------------
\documentclass{article}
\usepackage{res/packages/spconf,amsmath,graphicx}
\graphicspath{{res/imgs/},{res/plots/}}
\usepackage{hyperref}
\usepackage{url}
\newcommand{\link}[1]{\href{#1}{\textit{#1}}}
% Example definitions.
% --------------------
\def\x{{\mathbf x}}
\def\L{{\cal L}}

\renewcommand{\thesection}{\Roman{section}}
\renewcommand{\thesubsection}{\roman{subsection}}
\renewcommand{\thesubsubsection}{\alph{subsubsection}}


%prout


% Title.
% ------
\title{Website analyse : \textit{miniclip.com}}
%
% Single address.
% ---------------
\name{28681700
}
\address{}
%
% For example:
% ------------
%\address{School\\
%	Department\\
%	Address}
%
% Two addresses (uncomment and modify for two-address case).
% ----------------------------------------------------------
%\twoauthors
%  {A. Author-one, B. Author-two\sthanks{Thanks to XYZ agency for funding.}}
%	{School A-B\\
%	Department A-B\\
%	Address A-B}
%  {C. Author-three, D. Author-four\sthanks{The fourth author performed the work
%	while at ...}}
%	{School C-D\\
%	Department C-D\\
%	Address C-D}
%
\begin{document}
%\ninept
%
\maketitle
%
\begin{abstract}
This report contains an analysis of the website \link{miniclip.com}. The analysis covers three particular aspects: \textit{HTTP}, \textit{DNS} and \textit{TLS}.
\end{abstract}
%
% \begin{keywords}
% One, two, three, four, five
% \end{keywords}
%
\section{Introduction}
\label{sec:intro}
\subsection{Website}
\label{sub:web}
\textit{Miniclip} is a free online games website. It was launched in 2001 by \textit{Robert Small} and \textit{Tihan Presbie}. The first thing to mention is that \link{miniclip.com} is automatically redirected to \link{www.miniclip.com/games/en/}, it will be explained in \textbf{\nameref{sec:HTTP}} section. The analysis will be focused on the main page because the content that is exposed about this page is pratically the same on all other pages. 
\subsection{Tools}
\label{sub:tools}
To perform the analysis we need some tools, so for :
\begin{itemize}
    \item[--] \textit{HTTP}, I used \textit{Firefox Web Developper} tools, \textit{Google Chrome Developper Tools}.
    \item[--] \textit{DNS}: I used \textit{dig} command and \link{www.atlas.ripe.net} .
    \item[--] \textit{TCP}: I used \textit{WireShark} and \textit{Firefox Web Developper} tools.
\end{itemize}
And also particular websites for each aspect that will be mentionned below.

\section{HTTP}
\label{sec:HTTP}

\subsection{Headers}
\label{sub:headers}

As said in \nameref{sub:web}, the url \link{http://miniclip.com} is automatically redirected to \link{https://www.miniclip.com/games/en/}, this behavior is due to my browser and will not act necessarily the same on a different browser. 

Before requesting \url{https://www.miniclip.com/games/en/}, the browser will be redirected three times due to the \textbf{301 \text{or} 307 HTTP status} returned by each request. The 301 or 307 status tells to the browser that he has to request the url contained in the \texttt{location} field for many reasons.


\textbf{1.}
The browser will send an \textit{HTTP/1.1} request (\url{http://miniclip.com}) to the server (as requested) that contains inter alia \texttt{Upgrade-Insecure-Requests} field set to \texttt{1}. As mention on \textit{MDN} website \cite{upgrade-insecure-request}, this field tells to the server that, if it is available, it should redirect the client to the \textit{HTTPS} version. As the server can be reached in HTTPS, it returns a 307 status code (Internal Redirect) with \texttt{location} field set to \url{https://miniclip.com}.

\textbf{2.} 
Then the browser will move to the \texttt{location} field value with a \textit{HTTP/2.0} request. The response headers will return a 301 status code with the \texttt{location} \url{https://www.miniclip.com}, a subdomain of miniclip.com. Now, all HTTP requests will be executed in \textit{HTTP/2.0}.

\textbf{3.}
From the beginning, all HTTP requests contain an \texttt{Accept-Language} field set to \texttt{en} (in my case) but it is interesting in this request. The new request to the subdomain will again return a 301 status code to \url{https://www.miniclip.com/games/en/}. We can see that we are redirected to the english main page but it can redirect the client to a lot of available language pages. The browser contains a priority queue with prefered languages for the user that it sends in HTTP request and the server chooses the most preferred language available in its pages.

And finally the client will request the new url to the server that will return a \texttt{200 Status Code} (OK) and the
source code of the page stored in the body, the client is now able to load the content (in HTML file).

\subsection{Resources domains}
\label{sub:resdom}

When the client has loaded the HTML, he needs to load all the content linking in the file from different domains (\url{www.youtube.com}, \url{apis.google.com}, \url{static.miniclipcdn.com}, , ...). In order to do that, it sends requests to all servers that contain data. For the main page, it sends 94 requests. The eight most requested domains are represented in Figure \ref{fig:resdom} with the number of requests per domain. As we are on \textit{HTTP/2.0}, \textit{multiplexing} is used and one TCP connection is established between the client and a domain containing data that the client needs to download.
% The website need a lot of images to illustrate games you can choose.
Resources loading from \textit{miniclip} subdomain are not only loaded from one \textit{miniclip} subdomain. For example, resources are loaded from \url{static.miniclipcdn.com}, \url{static2.miniclipcdn.com} or \url{static3.miniclipcdn.com}. This behavior is due to the browser that has a hard limit on the number of parallel requests it can execute to the same domain at the same time. Here the client is able to load three times more information at the same time from miniclip subdomains.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.45\textwidth]{res/imgs/domains.png}
    \caption{Resources domains}
    \label{fig:resdom}
\end{figure}

\subsection{Resources types}
\label{sub:res}

As seen on the Figure \ref{fig:res}, 57\% of the data loaded is mp4. It is due to a single video that is shown to present a game. The rest is essentially images and JavaScript, this is perfectly normal, the website has to show the preview of games (images) and uses JavaScript to animate the website, like showing five differents games every 2 seconds in a frame. Apart from that, it just needs to redirect the client if he decides to click on a game.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.45\textwidth]{res/imgs/resources.png}
    \caption{Resources types}
    \label{fig:res}
\end{figure}

\subsection{Cookies}
\label{sub:cookies}

\subsubsection{Types}

There are a lot of cookies used to track the client along all the website. They can be set by \textit{miniclip} itself or other domains when requests are made (IFrame or JS). There are cookies for advertisement that are set in normal mode or 'incognito' mode (\texttt{$\_\_$gads} is a Google cookie preventing the same ads from being shown to the client too many times, \texttt{$\_$fbp} is a Facebook cookie used to set third-party advertisement, ...). There are cookies for identifying the client . There are also cookies about client information such as location, language, ... (\texttt{$\_$country$\_$code} is used to identify the client's country, \texttt{$\_$eu$\_$cookie} is used to identify if the client is in Europe, \texttt{$\_$language$\_$code} is used to identify the language that has to be chosen by the server, ...).

If we try to connect our facebook account on the website, plenty of cookies set by facebook appear. First, just by clicking on the facebook connect button, a cookie named \texttt{datr} is set and serves to track the user clicking on facebook content over other websites (even without being connected). After having linked the Facebook account, we can find cookies like \texttt{c$\_$user} that contains the Facebook user ID, \texttt{fb} that helps for friend suggestions or \texttt{xs} that maintains the session over other miniclip pages or subdomains.

\subsubsection{Special behavior}

When the client loads the website free from cookies (First time or in 'incognito' mode), \texttt{$\_\_$gads} and \texttt{$\_$fbp} cookies don't appear anywhere, that means that they are not set anywhere when the ressources are loaded (with set\_cookie). In fact, they are set from a \textit{JavaScript}, the \texttt{$\_\_$gads} cookie is set in the Javascript contained in \url{https://securepubads.g.doubleclick.net/gpt/pubads_impl_modern_2019112101.js} and the \texttt{$\_$fbp} cookie is set in \url{https://connect.facebook.net/signals/config/1451566791782906?v=2.9.14&r=stable}.
% On \textit{miniclip}, there are 4 different cookies owners: \textit{miniclip, google, youtube} and \textit{facebook}.
% \begin{itemize}
%     \item[--] \textbf{miniclip}
%     \begin{itemize}
%         \item \texttt{\_country\_code, \_eu\_cookie} : Contain localisation informations.
%         \item \texttt{\_fbp} : It is a Facebook cookie that is used for advertisment.
%         \item \texttt{\_\_ads} : It is a Google cookie that is used to not showing the client too much time same advertisments.
%     \end{itemize}
%     \item[--] \textbf{facebook}
%     If the client have already registered, he has these cookies \cite{facebook-cookies}:
%     \begin{itemize}
%         \item \texttt{act} : Tells when the user logged in.
%         \item \texttt{c\_user} : Contains the facebook login ID.
%         \item ...
%     \end{itemize}
%     When the user has open an incognito tab, these cookies are session cookies, instead, they expire in 90 days.
%     \item[--] \textbf{google}
%     \item[--] \textbf{youtube}
% \end{itemize}

\subsection{TCP Ports}
\label{sub:ports}

Every HTTPS request is established over the 443$^{\text{rd}}$ TCP port and every HTTP request is established over the 80$^{\text{th}}$ TCP port.

% \subsection{Non stantard headers}
% \label{sub:nonstandard}

% \textbf{X-Cache} signal that the server proxy has a valid copy of the page in its cache.


\subsection{Round Trip Time (RTT)}
\label{sub:rtt}

From the same computer in Louvain-la-Neuve, we obtain a RTT of 2.015 ms in average (on 33 packets). But we obtain different figures from other localisations, here are the figures : 
\begin{itemize}
    \itemsep-0.1em 
    \item United States :  0.775 ms
    \item South Korea : 1.549 ms
    \item Libramont, BE : 10.675 ms
    \item France : 26.801 ms
    \item Brazil : 206.450 ms
\end{itemize}

% \subsection{Traceroute}
% \label{sub:trace}

% \[
% \begin{tabular}{|c|c|c|}
%     \hline 
%     % vlan22.bb1.bru1.be.m247.com & 
%      0 & 185.104.186.1 & Brussels \\
%     \hline 
%     %  te0-3-0-2.250.rcr21.bru01.atlas.cogentco.com &
%      1 & 149.11.170.113 & Brussels\\
%      \hline
%     %  be3677.ccr42.ams03.atlas.cogentco.com &
%      2 &  154.54.60.133 & United States\\
%      \hline
%     %  be2814.ccr42.fra03.atlas.cogentco.com &
%      3 &  130.117.0.142 & Frankfurt\\
%      \hline
%      4 & 149.14.159.194 & Berlin\\
%       \hline
% \end{tabular}
% \]
\section{DNS}
\label{sec:DNS}

% \begin{figure}
%     \centering
%     \includegraphics[width=0.45\textwidth]{Latex/res/imgs/dig.png}
%     \caption{dig miniclip.com}
%     \label{fig:dig}
% \end{figure}

For this section we will focus on the different IP addresses that are used to do HTTP requests to obtain the content of miniclip.com, name servers and the Time To Live (TTL) of each server.

\subsection{IP addresses for HTTP requests}

\subsubsection{Explanation}
\label{subsub:ipexp}

\textit{\underline{About }}: All tests were made on the 6$^{\text{th}}$ of December 2019, in \href{https://goo.gl/maps/o6d29MMUkajAf4NXA}{Intel room} located in \href{https://goo.gl/maps/o6d29MMUkajAf4NXA}{Louvain-la-Neuve}.

\vspace{0.5cm}

Miniclip uses four different IPv4 addresses to share its content: 
\begin{itemize}
    \itemsep-0.1em 
    \item $13.225.233.7$
    \item $13.225.233.19$
    \item $13.225.233.45$
    \item $13.225.233.84$
\end{itemize}

To get more information about these addresses : As seen on \textit{IP wanana} website \cite{ip}, all of these four addresses are hosted by \textit{Xerox Corporation} located in \href{https://goo.gl/maps/ArqaLQaFP1qYbP2j8}{Norwalk} in the United States. In fact, these addresses are linked to Content Delivery Networks (CDN), if we send a request from the UK (with \url{https://gf.dev/}), we obtain four different addresses that have the prefix $13.35.0.0/16$ and are hosted by Amazon as we can see on the IP range file of aws \cite{awsrange}. 


CDN's are requested because they allow the client to obtain the content as quickly as possible, each CDN has a copy of the main miniclip server. So the IP requested to obtain the content depends on the client's location and the CDN contacted.

\subsubsection{Time To Live}
\label{subsub:ipttl}

The Time To Live of the CDN is set to 60 seconds because the best CDN may change over the network due to other users and the network bandwidth volatility (congestion, load, ...). The goal is to enable a well balanced and responsive network because most of the data are shared between the client and the CDN.

\subsection{Name servers}
\subsubsection{Explanation}
\label{subsub:nsexp}

Name Server's (NS) used by \url{miniclip.com} are:
\begin{itemize}
    \itemsep-0.1em 
    \item ns-251.awsdns-31.com
    \item ns-867.awsdns-44.net
    \item ns-1577.awsdns-05.co.uk
    \item ns-1518.awsdns-61.org
\end{itemize}

these Name Server's are all from \textit{aws} and are located in different towns in the United States. these addresses can be reached over IPv4 or IPv6, their prefixes are respectively 205.251.0.0/16 and 2600:9000::/32 .

\subsubsection{Time To Live}
\label{subsub:nsttl}

The Time To Live of these Name Servers corresponding to the domain name are set to approximatly 2 days. And the IP addresses corresponding to the Name Servers has also a TTL of 2 days. These TTL are pretty long because the Domain Name is pretty static so Name Servers are well set for a long time and Name Servers don't change their IP address too often. Of course it is better to refresh as much as possible but it is really expensive for the network to send request, instead each server trusts its cache until the TTL is surpassed.

\subsection{Extra records}
\label{subsub:extra}

For \url{miniclip.com}, we have 3 extra records that are MX, TXT and SOA.
\begin{itemize}
    \itemsep-0.1em
    \item \textbf{MX} specifies the mail server responsible for accepting email messages on behalf of a domain name \cite{mx}, here it is \url{miniclip-com.mail.protection.outlook.com} and it is handled by Microsoft Corporation. 
    \item \textbf{TXT} is used to add extra arbitrary text over a host, readable information for a human.
    \item \textbf{SOA} (Start of Authority) is used to control zone transfers between the slave server and the master server. It also contains administrative informations.
\end{itemize}



\section{Transport Layer Security (TLS)}
\label{sec:TCP}
% Cipher Suite: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)

To ensure the security of its clients, miniclip uses the version 1.2 of Transport Layer Security (TLSv1.2) protocol with HSTS mechanism. This protocol is used to encapsulate the information with an encryption. To trust the server, the client has to see the server's certificate.

% EXPLIQUER LES ETAPES (HANDSHAKE, TICKET, ...)

\subsection{HSTS (HTTP Strict Transport Security)}
\label{sub:hsts}

Since that time when \textit{miniclip.com} has HSTS mechanism, it is only accessible using HTTPS connection and so, TLS is forced to be used. In all HTTP/2.0 answers headers, we have got \texttt{strict-transport-security: max-age=
63072000; includeSubDomains; preload}

\begin{itemize}
    \itemsep -0.1em
    \item \textbf{max-age} is the time, in seconds, that the browser should remember that a site is only to be accessed using HTTPS.
    \item \textbf{includeSubDomains} tells that this rule applies to all of the site's subdomains as well.
    \item \textbf{preload} is using to preload a list that contains domains names that by default support HSTS.
\end{itemize}

\subsection{Certificate}
\label{sub:certificate}

It is a X.509v3 certificate.

\subsubsection{Issuer}
The server's certificate is issued by Amazon (AIA: \url{http://crt.sca1b.amazontrust.com/sca1b.crt}). This certificate is used on the domain (miniclip.com) and all subdomains.

Certificates have hierarchical authorities, the most important is the root, here, we have got :

\[
    \begin{array}{c}
        \text{miniclip.com}\\\text{(End-user)}
    \end{array}
    \xrightarrow[]{\text{issuer}}
    \begin{array}{c}
        \text{Amazon}\\\text{(Intermediate)}
    \end{array}
    \xrightarrow[]{\text{issuer}}
    \begin{array}{c}
        \text{Amazon Root CA}\\\text{(Intermediate)}
    \end{array}
\]

\[    
    \xrightarrow[]{\text{issuer}}
    \begin{array}{c}
        \text{Starfield Services Root Certificate Authority}\\\text{(Intermediate)}
    \end{array}
\]

\[     
    \xrightarrow[]{\text{issuer}}
    \begin{array}{c}
        \text{Starfield Technologies, Inc.}\\\text{(Root)}
    \end{array}
\]

As seen on \href{https://www.ssllabs.com/ssltest/analyze.html?d=miniclip.com&s=99.84.224.21}{SSLabs}, we can see that the handshake works with a lot of browsers.


\subsubsection{Encryption/Decryption}
It uses \texttt{SHA-256 with RSA Encryption}.

SHA-256 is used to hash the message, it is a unilateral hash algorithm and it produces a 256 bits message.

RSA (Rivest–Shamir–Adleman) is a cryptosystem based on a pair of private and public keys. The public key is communicated to everyone and is used to encrypt message. The private key is used to decrypt the message and is unique, it is kept secret.


\subsubsection{Validity}

On the 7$^{\text{th}}$ of December 2019, the certificate of miniclip.com is available until 3$^{\text{rd}}$ of October 2020, 12 am. The more the Certificate Authority is important the more the validity is long because the CA is more reliable.


% References should be produced using the bibtex program from suitable
% BiBTeX files (here: strings, refs, manuals). The IEEEbib.bst bibliography
% style file from IEEE produces unsorted bibliography list.
% -------------------------------------------------------------------------
\bibliographystyle{res/bib/IEEEbib}
\bibliography{res/bib/strings,res/bib/refs,res/bib/fields}

\end{document}
